#!/bin/sh -e

if [ -z "$TOOLS" ]
then
	echo "TOOLS variable is not set"
	exit 1
fi

mkdir -p $TOOLS
cd $TOOLS

# Arm AArch64 cross compiler
if [ ! -f arm-gnu-toolchain-13.3.rel1-x86_64-aarch64-none-elf.tar.xz ]
then
	wget https://developer.arm.com/-/media/Files/downloads/gnu/13.3.rel1/binrel/arm-gnu-toolchain-13.3.rel1-x86_64-aarch64-none-elf.tar.xz
fi
if [ ! -f arm-gnu-toolchain-13.3.rel1-x86_64-aarch64-none-elf ]
then
	tar -xf arm-gnu-toolchain-13.3.rel1-x86_64-aarch64-none-elf.tar.xz
fi

# QEMU (newer version that supports Raspberry Pi 4 Model B)
if [ ! -d qemu ]
then
	git clone git@github.com:qemu/qemu.git
	cd qemu
	git checkout stable-9.1
	cd ..
fi
if [ ! -d qemu/build ]
then
	cd qemu
	mkdir build
	cd build
	../configure
	make
fi
