# AArch64OS

AArch64OS - an operating system for the Arm A-profile instruction set architecture AArch64 execution state.

This is a hobby project that scratches a particular itch of mine to learn about:

- Operating system development.
- Arm AArch64 architecture.
- Raspberry Pi 4 Model B hardware.
- Assembly language programming.
- Bootstrapping a system.
- Tradeoffs in simplicity, performance, and complexity.

Some goals:

- Bootstrap as early as possible. Build a simple kernel and assembler in assembly that builds itself, then use that to
  build the rest of the operating system (we'll see...).
- Minimize dependencies for building and running the operating system (related to bootstrap goal).
- Learn and have fun!

Non-goals:

- A practical system for daily use.

The project is largely a reaction to the extreme complexity of most modern development environments. The goals will
likely evolve, and when the 'fun' stops, so will the project.

## Quick Start

Assumes a Debian-based system, but should work on other systems with minor modifications.

You may get errors when running get-tools if you don't have some required system libraries installed that openocd or
qemu depend on.

TODO: Add a list of required packages.

```sh
git clone git@github.com:dsmcfarl/aarch64os.git
cd aarch64os
source .envrc  # adds bin/ to PATH and sets some environment variables
get-tools  # downloads and builds tools to tools/ directory
qemu
```

## Organization

The project is organized as follows:

- `bin/` Scripts for building, running, and debugging the operating system.
- `config/` Configuration files for build tools and bootloader, etc.
- `include/` Header files for the operating system.
- `src/` Source code for the operating system. Separate sub-directories for different components.
- `build/` Build artifacts (not committed).
- `tools/` Third party tools for building and debugging the operating system. (not committed generated by bin/get-tools)
- `.envrc` Environment variables for development (can be loaded with [direnv](https://direnv.net/) or source manually).

## Hardware

The project uses a Raspberry Pi 4 Model B (RPi4B). It is not using the Raspberry Pi 5 Model B (RPi5B) because QEMU
does not support the RPi5B yet and documentation for the RPi4B is better currently (2024). Also, the Raspberry Pi
Compute Module 4 (RPiCM4) could be an interesting target for this project but has not been tested yet.

Remote debugging is supported with a JTAG probe and openocd. The Segger J-Link Base has been tested with this project
but other probes should also work.

A USB to TTL (3.3V) serial cable is required for viewing logs and input/output.

## Tools

- [QEMU](https://www.qemu.org/) - Emulator for the Raspberry Pi 4 Model B.
- [GNU Arm Embedded Toolchain](https://developer.arm.com/downloads/-/arm-gnu-toolchain-downloads) - Just using binutils.
- [Raspberry Pi Firmware](https://github.com/raspberrypi/firmware.git) - Bootloader and firmware files.
- [OpenOCD](http://openocd.org/) - Open On-Chip Debugger for remote debugging.
- [Minicom](https://salsa.debian.org/minicom-team/minicom) - Serial communication program (others can be used).
